<html>
<script>
/**
 * Copyright 2010 by Jeff Yutzler
 * All Rights Reserved
 * This software is provided for use by TheSabre.com 
 * and its affiliates.
 */
/**
 * This function is here to work with a web page
 * as an event handler to a button
 */
function go() {
	// Parse the makes into an array (filtering out empty responses)
	var makes = document.getElementById("makes").value.split(" ");
	if (isNaN(makes[0])) {
		makes = [];
	}
	// Add in the extra points
	for (var inx = 0; inx < document.getElementById("xpmakes").value; inx++){
		makes.push (20);
	}
	// Parse the misses into an array 
	// and sort so we consider shorter misses first
	var misses = document.getElementById("misses").value;
	misses = isNaN(misses[0]) ? [] : misses.split(" ").sort();
	// Make a temporary array containing the missed extra points
	// and insert it to the beginning of the misses array
	var tempMisses = [];
	for (inx = 0; inx < document.getElementById("xpmisses").value; inx++){
		tempMisses.push (20);
	}
	misses = tempMisses.concat(misses);
	// Call the algorithm and present the results
	var answer = calculate (makes, misses);
	document.getElementById("answer").innerHTML = "Grade: " + answer;
}
/** 
 * Calculates kicker rating
 * taking two arrays as input 
 * and returning a percentage
 */
function calculate (makes, misses) {
	// Three variables control the scaling of the algorithm
	// I call them pitch, yaw, and roll for lack of better terms
	// Affects the size of the penalty for missed kicks  
	var pitch = 20.0;
	// Determines the start for bonus points for longer makes and
	// affects the decrease of the size of the penalty for longer misses
	// yaw + pitch equals the point at which there is zero penalty for missing
	// var yaw = 30.0; // high school
	var yaw = 35.0; // NCAA
	// var yaw = 40.0; // NFL
	// The rate at which bonus points are awarded for longer kicks
	var roll = 10.0;
	// Some temporary values
	var value, oldValue, current;
	// Provide a small starting value so the kicker starts 
	// with a grade of 100% 
//	var numerator = 1, denominator;
	var numerator = 10, denominator;

	// Go through the makes first,
	// adding to the numerator and denominator
	for (var inx in makes) {
		current = Number(makes[inx]);
		// Sometimes an extra space gets recorded as a zero
		if (current === 0) {
			continue;
		}
		numerator += current;
		// Assign bonus points to longer kicks
		if (current > yaw) {
			numerator += roll * (current - yaw);
		}
	}
	denominator = numerator;
	
	// Go through the misses next,
	// penalizing the kicker by increasing
	// the denominator faster than the numerator
	for (inx in misses) {
		current = Number(misses[inx]);
		// Sometimes an extra space gets recorded as a zero
		if (current === 0) {
			continue;
		}
		// Increase the severity of missing shorter kicks
		current = Math.max((current - pitch), 0);
		// Only consider misses that lower the average
		oldValue = numerator / denominator;
		value = (numerator + current) / (denominator + yaw);
		if (oldValue > value) {
			numerator += current;
			denominator += yaw;
		}
	}
	
	// Announce the answer
    value = Math.round(Math.pow((numerator / denominator), 3.0) * 10000.0) / 100.0;
	return value + "%";
}
</script>
<body>
<table>
<tbody>
<tr>
<td colspan="2">
<H1>Field Goal Grading Calculator</H1>
</td>
</tr>
<tr>
<td colspan="2">
<H3>Extra Points</H3>
</td>
</tr>
<tr>
<td colspan="2">
<i>
Extra points count the same as 20 yard field goals.
</i>
</td>
</tr>
<tr>
<td>
Makes: 
<input type="text" id="xpmakes" size="5"/>
</td>
<td>
Misses:
<input type="text" id="xpmisses" size="5"/>
</td>
</tr>
<tr>
<td colspan="2">
&nbsp;
</td>
</tr>
<tr>
<td colspan="2">
<H3>Field Goals</H3>
</td>
</tr>
<tr>
<td colspan="2">
<i>
Enter the distance of makes and misses, separated by spaces.
</i>
</td>
</tr>
<tr>
<td colspan="2">
Makes: 
</td>
</tr>
<tr>
<td colspan="2">
<textarea id="makes" cols="30" rows="5"></textarea>
</td>
</tr>
<tr>
<td colspan="2">
Misses:
</td>
</tr>
<tr>
<td colspan="2">
<textarea id="misses" cols="30" rows="5"></textarea>
</td>
</tr>
<tr>
<td colspan="2">
<input type="button" onclick="go()" value="Go!"/>
</td>
</tr>
<tr>
<td colspan="2">
<div id="answer"></div>
</td>
</tr>
</tbody>
</table>
</body>
</html>
